# {{ ansible_managed }}
# PostgreSQL Client Authentication Configuration File
#
# Generated by Ansible
# All handmade changes can be rewritten!
#
# Allow any user on the local system to connect to any database with
# any database user name using Unix-domain sockets (the default for local
# connections).
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD

# Default:
{% for connection in pg_cfg_pg_hba_default %}
# {{ connection.comment }}
{{ connection.type }}  {{ connection.database }}  {{ connection.user }}  {{ connection.address }}  {{ connection.method }}
{% endfor %}

# Custom password hosts
{% for host in pg_cfg_pg_hba_passwd_hosts %}
host  all  all  {{ host }}  password
{% endfor %}

# Application servers
{% for host in app_servers %}
host  all  all  {{ host }}/32  password
{% endfor %}
{% for host in game_servers %}
host  all  all  {{ host }}/32  password
{% endfor %}
{% for host in pg_app_servers %}
host  all  all  {{ host }}/32  password
{% endfor %}

# Trusted hosts
{% for host in pg_cfg_pg_hba_trust_hosts %}
host  all  all  {{ host }}  trust
{% endfor %}

# User custom
{% for connection in pg_cfg_pg_hba_custom %}
# {{ connection.comment }}
{{ connection.type }}  {{ connection.database }}  {{ connection.user }}  {{ connection.address }}  {{ connection.method }}
{% endfor %}

# Replication
{% if pg_has_replica %}
{% for host in pg_replicas %}
hostssl replication {{ pg_replica_user }} {{ host }}/32 md5
host replication {{ pg_replica_user }} {{ host }}/32 md5
{% endfor %}
{% endif %}

# Read only access
{% if pg_read_only_access is defined %}
{% for access in pg_read_only_access %}
host  {{ access.database }}  {{ access.user }}  {{ access.netmask }} password
{% endfor %}
{% endif %}